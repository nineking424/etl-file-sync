version: '3.8'

services:
  # ETL File Sync (Kafka + Consumer)
  etl-file-sync:
    image: etl-file-sync:latest
    container_name: etl-test
    ports:
      - "9092:9092"
    volumes:
      - ./.etl-test-shared:/shared
    environment:
      # Multi-consumer configuration
      - ETL_CONSUMER_COUNT=4
      - ETL_NUM_PARTITIONS=4
      # FTP settings (use real FTP server)
      - FTP_PASSIVE_MODE=true
      - DLQ_TOPIC_SUFFIX=-dlq
      - SRC_FTP_SERVER1_TYPE=ftp
      - SRC_FTP_SERVER1_HOST=192.168.1.4
      - SRC_FTP_SERVER1_PORT=21
      - SRC_FTP_SERVER1_USER=user01
      - SRC_FTP_SERVER1_PASS=Votmdnjem01!
      - DST_FTP_SERVER1_TYPE=ftp
      - DST_FTP_SERVER1_HOST=192.168.1.4
      - DST_FTP_SERVER1_PORT=21
      - DST_FTP_SERVER1_USER=user02
      - DST_FTP_SERVER1_PASS=Votmdnjem02!
      # Local transfer configuration
      - LOCAL_SERVER1_TYPE=local
      - LOCAL_SERVER1_HOST=localhost
      - LOCAL_SERVER1_PORT=0
      - LOCAL_SERVER1_USER=
      - LOCAL_SERVER1_PASS=
      - LOCAL_SERVER1_BASE_PATH=/shared
    command: ["test-transfer", "test-group", "localhost:9092"]
    networks:
      - etl-test-net
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Kafka UI for monitoring
  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    ports:
      - "8080:8080"
    extra_hosts:
      - "localhost:host-gateway"
    environment:
      - KAFKA_CLUSTERS_0_NAME=etl-test
      - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=localhost:9092
    depends_on:
      - etl-file-sync

networks:
  etl-test-net:
    driver: bridge
